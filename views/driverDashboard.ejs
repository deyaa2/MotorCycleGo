<!DOCTYPE html>
<html>
<head>
  <title>Driver Dashboard</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="/assets/css/myframWork.css">
  <link rel="stylesheet" href="/assets/css/all.min.css">
  <style>
    .message {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 20px;
    }
    .map {
      height: 200px;
      width: 100%;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <!-- Start Header -->
  <%- include('partials/header') %>
  <!-- End Header -->
  <div class="imageLoader flex-center" id="loader">
    <img src="/assets/images/chain.png" alt="loading image">
  </div>
  <h1>Ride Requests</h1>
  <div id="messages"></div>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    async function loadMessages() {
      const res = await fetch('/api/messages');
      const messages = await res.json();
      const container = document.getElementById("messages");
      container.innerHTML = "";

      messages.forEach((msg, index) => {
        // Create message container
        const div = document.createElement("div");
        div.classList.add("message");

        // Add text
        const p = document.createElement("p");
        p.innerText = msg.text;
        div.appendChild(p);

        // Add map container
        const mapDiv = document.createElement("div");
        mapDiv.id = `map-${index}`;
        mapDiv.classList.add("map");
        div.appendChild(mapDiv);

        container.appendChild(div);

        // Initialize map
        const map = L.map(mapDiv.id).setView([msg.pickup.lat, msg.pickup.lng], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // Add pickup marker
        L.marker([msg.pickup.lat, msg.pickup.lng])
          .addTo(map)
          .bindPopup("Pickup")
          .openPopup();

        // Add destination marker
        L.marker([msg.destination.lat, msg.destination.lng])
          .addTo(map)
          .bindPopup("Destination");
      });
    }

    // Load messages every 5 seconds
    setInterval(loadMessages, 5000);
    loadMessages();
  </script>
  <script src="/assets/javaScript/header.js"></script>
  <script src="/assets/javaScript/main.js"></script>
  <script src="/assets/javaScript/loading.js"></script>
  <script src="/assets/javaScript/mobile-enhanced.js"></script>
</body>
</html>
